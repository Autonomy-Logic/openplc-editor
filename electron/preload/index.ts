const domReady = (condition: DocumentReadyState[] = ['complete', 'interactive']) => {
  return new Promise((resolve) => {
    if (condition.includes(document.readyState)) {
      resolve(true);
    } else {
      document.addEventListener('readystatechange', () => {
        if (condition.includes(document.readyState)) {
          resolve(true);
        }
      });
    }
  });
};

const safeDOM = {
  append(parent: HTMLElement, child: HTMLElement | Document) {
    if (!Array.from(parent.children).find((e) => e === child)) {
      return parent.appendChild(child);
    }
  },
  remove(parent: HTMLElement, child: HTMLElement) {
    if (Array.from(parent.children).find((e) => e === child)) {
      return parent.removeChild(child);
    }
  },
};

const useLoading = () => {
  const preloadClassName = 'preload';
  const logoClassName = 'logo';
  const friendsClassName = 'friends';
  const styleContent = `
  :root {
    --base-color: rgb(0, 0, 0);
    --engine-color: rgb(3, 102, 255);
  }

  .${preloadClassName} {
    position: fixed;
    top: 0;
    left: 0;
    width: 100vw;
    height: 100vh;
    display: flex;
    align-items: center;
    justify-content: center;
    flex-direction: column;
    z-index: 99999;
    background: var(--base-color);
    color: white;
  }

  .${logoClassName} {
    display: flex;
    align-items: center;
  }

  .${logoClassName} p {
    font-wight: bold;
    font-size: 48px;
    margin-left: -150px;
  }

  .${logoClassName} svg {
    width: 500px;
    height: 500px;
  }

  .${friendsClassName} {
    margin: -176.5px 0 0 550px;
  }

  .${friendsClassName} p {
    font-size: 18px;
    margin-bottom: 10px;
  }

  .${friendsClassName} svg {
    width: 50px;
    height: 50px;
  }

  .${friendsClassName} div {
    display: flex;
    justify-content: flex-end;
    align-items: center;
  }
      `;
  const title = 'OpenPLC Editor';
  const friendsTitle = 'OpenPLC Friends';
  const style = document.createElement('style');
  const container = document.createElement('div');
  const content = `
    <div class=${logoClassName}>
      <svg
        xmlns="http://www.w3.org/2000/svg"
        xmlns:xlink="http://www.w3.org/1999/xlink"
        width="251"
        zoomAndPan="magnify"
        viewBox="0 0 188.25 188.250001"
        height="251"
        preserveAspectRatio="xMidYMid meet"
        version="1.0"
      >
        <defs>
          <clipPath id="739f7716e1">
            <path
              d="M 37.800781 38 L 93.828125 38 L 93.828125 150.042969 L 37.800781 150.042969 Z M 37.800781 38 "
              clip-rule="nonzero"
            />
          </clipPath>
          <clipPath id="72d18e720b">
            <path
              d="M 93.703125 37.988281 L 149.730469 37.988281 L 149.730469 149.292969 L 93.703125 149.292969 Z M 93.703125 37.988281 "
              clip-rule="nonzero"
            />
          </clipPath>
        </defs>
        <g clip-path="url(#739f7716e1)">
          <path
            fill="#0366ff"
            d="M 31.710938 43.75 L 25.785156 49.710938 L 43.246094 67.210938 C 52.875 76.800781 61.058594 84.90625 61.488281 85.179688 C 61.878906 85.453125 63.203125 86.15625 64.371094 86.738281 C 66.398438 87.714844 66.90625 87.792969 72.671875 87.910156 L 78.792969 88.0625 L 78.792969 99.992188 L 72.285156 100.148438 C 66.515625 100.300781 65.5 100.417969 63.902344 101.199219 C 62.851562 101.667969 62.03125 102.210938 62.03125 102.40625 C 62.03125 102.640625 61.839844 102.796875 61.605469 102.796875 C 60.980469 102.796875 26.058594 137.757812 26.253906 138.226562 C 26.371094 138.613281 34.75 147.230469 36.816406 149.136719 L 37.789062 150.035156 L 65.695312 122.167969 C 81.054688 106.8125 93.601562 94.105469 93.601562 93.871094 C 93.601562 93.519531 39.933594 39.578125 38.21875 38.214844 C 37.789062 37.863281 36.582031 38.878906 31.710938 43.75 Z M 31.710938 43.75 "
            fill-opacity="1"
            fill-rule="nonzero"
          />
        </g>
        <g clip-path="url(#72d18e720b)">
          <path
            fill="#0366ff"
            d="M 121.71875 65.660156 L 93.65625 93.761719 L 121.679688 121.824219 L 149.703125 149.847656 L 151.144531 148.5625 C 151.925781 147.859375 154.652344 145.171875 157.1875 142.558594 L 161.746094 137.882812 L 156.054688 132.152344 C 152.898438 128.996094 150.210938 126.421875 150.054688 126.421875 C 149.9375 126.421875 149.585938 125.996094 149.3125 125.488281 C 149.039062 124.980469 148.378906 124.316406 147.871094 124.046875 C 147.363281 123.773438 146.933594 123.421875 146.933594 123.265625 C 146.933594 122.835938 144.597656 120.578125 144.167969 120.578125 C 143.972656 120.578125 143.816406 120.421875 143.816406 120.265625 C 143.816406 119.835938 127.605469 103.582031 126.121094 102.53125 C 123.121094 100.386719 122.1875 100.152344 115.289062 99.996094 L 108.738281 99.84375 L 108.738281 87.835938 L 114.117188 87.835938 C 120.667969 87.835938 123.003906 87.292969 126.238281 84.914062 C 126.511719 84.71875 134.660156 76.652344 144.324219 67.0625 L 161.863281 49.601562 L 155.859375 43.5625 C 152.585938 40.25 149.859375 37.558594 149.859375 37.558594 C 149.820312 37.558594 137.191406 50.1875 121.71875 65.660156 Z M 121.71875 65.660156 "
            fill-opacity="1"
            fill-rule="nonzero"
          />
        </g>
      </svg>
      <p>${title}</p>
    </div>
    <div class=${friendsClassName}>
      <p>${friendsTitle}</p>
      <div>
        <svg
          xmlns="http://www.w3.org/2000/svg"
          xmlns:xlink="http://www.w3.org/1999/xlink"
          width="800"
          zoomAndPan="magnify"
          viewBox="0 0 600 449.999984"
          height="600"
          preserveAspectRatio="xMidYMid meet"
          version="1.0"
        >
          <path
            fill="#ed3341"
            d="M 284.765625 12.890625 C 393.226562 14.15625 465.496094 65.71875 501.5625 167.578125 C 522.375 292.4375 475.5 379.15625 360.9375 427.734375 C 355.46875 427.734375 350 427.734375 344.53125 427.734375 C 338.160156 429.71875 331.914062 432.0625 325.78125 434.765625 C 307.066406 434.640625 288.316406 434.640625 269.53125 434.765625 C 233.035156 426.503906 199.050781 411.269531 167.578125 389.0625 C 101.671875 330.367188 76.671875 259.273438 92.578125 175.78125 C 122.042969 80.273438 186.105469 25.976562 284.765625 12.890625 Z M 277.734375 94.921875 C 359.113281 91.371094 409.113281 128.089844 427.734375 205.078125 C 432.515625 269.21875 405.171875 315.703125 345.703125 344.53125 C 281.621094 364.316406 229.667969 347.515625 189.84375 294.140625 C 153.667969 223.445312 166.558594 163.679688 228.515625 114.84375 C 244.1875 105.601562 260.59375 98.960938 277.734375 94.921875 Z M 277.734375 94.921875 "
            fill-opacity="0.9333"
            fill-rule="evenodd"
          />
        </svg>
        <svg
          xmlns="http://www.w3.org/2000/svg"
          xmlns:xlink="http://www.w3.org/1999/xlink"
          width="800"
          zoomAndPan="magnify"
          viewBox="0 0 600 449.999984"
          height="600"
          preserveAspectRatio="xMidYMid meet"
          version="1.0"
        >
          <defs>
            <clipPath id="a6fd813c2c">
              <path
                d="M 67.183594 338 L 134 338 L 134 428 L 67.183594 428 Z M 67.183594 338 "
                clip-rule="nonzero"
              />
            </clipPath>
          </defs>
          <path
            fill="#ec1b23"
            d="M 497.261719 -1.171875 C 503.515625 -1.171875 509.761719 -1.171875 516.011719 -1.171875 C 516.011719 5.078125 516.011719 11.328125 516.011719 17.578125 C 478.953125 90.140625 443.015625 163.578125 408.199219 237.890625 C 401.238281 239.449219 394.207031 241.011719 387.105469 242.578125 C 385.683594 242.289062 384.902344 241.507812 384.761719 240.234375 C 384.898438 237.636719 385.675781 235.292969 387.105469 233.203125 C 387.105469 232.421875 387.105469 231.640625 387.105469 230.859375 C 416.019531 173.375 444.535156 115.5625 472.652344 57.421875 C 474.21875 55.078125 474.21875 52.734375 472.652344 50.390625 C 435.726562 86.15625 398.617188 121.3125 361.324219 155.859375 C 351.171875 155.859375 341.011719 155.859375 330.855469 155.859375 C 354.230469 133.265625 377.667969 110.613281 401.167969 87.890625 C 406.636719 87.109375 409.765625 83.984375 410.542969 78.515625 C 440.855469 53.679688 469.765625 27.117188 497.261719 -1.171875 Z M 497.261719 -1.171875 "
            fill-opacity="0.9176"
            fill-rule="evenodd"
          />
          <path
            fill="#2b4da0"
            d="M 410.542969 78.515625 C 409.765625 83.984375 406.636719 87.109375 401.167969 87.890625 C 345.699219 87.890625 290.230469 87.890625 234.761719 87.890625 C 234.761719 110.546875 234.761719 133.203125 234.761719 155.859375 C 266.792969 155.859375 298.824219 155.859375 330.855469 155.859375 C 341.011719 155.859375 351.171875 155.859375 361.324219 155.859375 C 369.921875 155.859375 378.511719 155.859375 387.105469 155.859375 C 389.789062 180.878906 389.789062 205.878906 387.105469 230.859375 C 387.105469 231.640625 387.105469 232.421875 387.105469 233.203125 C 350.386719 233.203125 313.671875 233.203125 276.949219 233.203125 C 266.792969 233.203125 256.636719 233.203125 246.480469 233.203125 C 242.574219 233.203125 238.667969 233.203125 234.761719 233.203125 C 234.761719 236.328125 234.761719 239.453125 234.761719 242.578125 C 231.890625 252.265625 231.890625 261.640625 234.761719 270.703125 C 234.761719 301.953125 234.761719 333.203125 234.761719 364.453125 C 201.253906 366.675781 167.660156 367.457031 133.980469 366.796875 C 133.980469 357.421875 133.980469 348.046875 133.980469 338.671875 C 133.980469 229.296875 133.980469 119.921875 133.980469 10.546875 C 226.167969 10.546875 318.359375 10.546875 410.542969 10.546875 C 410.542969 33.203125 410.542969 55.859375 410.542969 78.515625 Z M 410.542969 78.515625 "
            fill-opacity="0.9765"
            fill-rule="evenodd"
          />
          <path
            fill="#e91d26"
            d="M 246.480469 233.203125 C 256.636719 233.203125 266.792969 233.203125 276.949219 233.203125 C 263.539062 246.625 249.476562 259.125 234.761719 270.703125 C 231.890625 261.640625 231.890625 252.265625 234.761719 242.578125 C 240.046875 241.117188 243.953125 237.992188 246.480469 233.203125 Z M 246.480469 233.203125 "
            fill-opacity="0.8824"
            fill-rule="evenodd"
          />
          <path
            fill="#2b4ea1"
            d="M 408.199219 237.890625 C 436.289062 235.730469 458.554688 245.886719 474.996094 268.359375 C 482.679688 292.753906 474.476562 309.554688 450.386719 318.75 C 421.460938 328.128906 391.773438 333.207031 361.324219 333.984375 C 352.574219 333.570312 343.980469 334.351562 335.542969 336.328125 C 329.835938 335.898438 324.757812 337.460938 320.308594 341.015625 C 316.535156 352.992188 316.144531 364.710938 319.136719 376.171875 C 318.796875 385.65625 322.707031 392.6875 330.855469 397.265625 C 337.171875 401.984375 344.203125 405.5 351.949219 407.8125 C 394.703125 415.191406 429.078125 401.910156 455.074219 367.96875 C 475.933594 359.148438 484.136719 365.785156 479.683594 387.890625 C 459.984375 417.675781 432.253906 435.253906 396.480469 440.625 C 367.496094 445.386719 340.148438 441.089844 314.449219 427.734375 C 311.144531 422.078125 306.457031 418.167969 300.386719 416.015625 C 292.945312 408.957031 287.867188 400.363281 285.152344 390.234375 C 281.980469 366.894531 284.324219 344.234375 292.183594 322.265625 C 312.5625 282.730469 343.421875 255.382812 384.761719 240.234375 C 384.902344 241.507812 385.683594 242.289062 387.105469 242.578125 C 394.207031 241.011719 401.238281 239.449219 408.199219 237.890625 Z M 377.730469 301.171875 C 381.777344 290.734375 386.464844 280.578125 391.792969 270.703125 C 397.742188 270.6875 403.601562 269.902344 409.371094 268.359375 C 422.738281 268.761719 434.066406 273.449219 443.355469 282.421875 C 438.125 287.449219 431.875 290.964844 424.605469 292.96875 C 409.074219 296.46875 393.449219 299.199219 377.730469 301.171875 Z M 358.980469 289.453125 C 357.277344 295.203125 354.933594 300.671875 351.949219 305.859375 C 348.734375 306.226562 345.605469 305.835938 342.574219 304.6875 C 347.738281 299.128906 353.210938 294.050781 358.980469 289.453125 Z M 358.980469 289.453125 "
            fill-opacity="0.9373"
            fill-rule="evenodd"
          />
          <path
            fill="#e91d26"
            d="M 391.792969 270.703125 C 386.464844 280.578125 381.777344 290.734375 377.730469 301.171875 C 369.890625 305.445312 361.296875 307.007812 351.949219 305.859375 C 354.933594 300.671875 357.277344 295.203125 358.980469 289.453125 C 367.625 279.648438 378.5625 273.398438 391.792969 270.703125 Z M 391.792969 270.703125 "
            fill-opacity="0.902"
            fill-rule="evenodd"
          />
          <path
            fill="#eb1c24"
            d="M 361.324219 333.984375 C 350.71875 354.875 340.5625 375.96875 330.855469 397.265625 C 322.707031 392.6875 318.796875 385.65625 319.136719 376.171875 C 325.085938 363 330.554688 349.71875 335.542969 336.328125 C 343.980469 334.351562 352.574219 333.570312 361.324219 333.984375 Z M 361.324219 333.984375 "
            fill-opacity="0.9059"
            fill-rule="evenodd"
          />
          <g clip-path="url(#a6fd813c2c)">
            <path
              fill="#ed1b23"
              d="M 133.980469 338.671875 C 133.980469 348.046875 133.980469 357.421875 133.980469 366.796875 C 112.671875 388.753906 90.015625 409.0625 66.011719 427.734375 C 66.011719 418.359375 66.011719 408.984375 66.011719 399.609375 C 89.429688 380.097656 112.085938 359.785156 133.980469 338.671875 Z M 133.980469 338.671875 "
              fill-opacity="0.9137"
              fill-rule="evenodd"
            />
          </g>
          <path
            fill="#ec1b23"
            d="M 300.386719 416.015625 C 306.457031 418.167969 311.144531 422.078125 314.449219 427.734375 C 312.570312 434.9375 310.226562 441.96875 307.417969 448.828125 C 301.953125 448.828125 296.480469 448.828125 291.011719 448.828125 C 289.191406 447.289062 287.628906 445.339844 286.324219 442.96875 C 289.058594 432.710938 293.746094 423.730469 300.386719 416.015625 Z M 300.386719 416.015625 "
            fill-opacity="0.8784"
            fill-rule="evenodd"
          />
        </svg>
      </div>
    </div>
  `;

  style.id = 'app-loading-style';
  style.innerHTML = styleContent;

  container.className = preloadClassName;
  container.innerHTML = content;
  return {
    appendLoading() {
      safeDOM.append(document.head, style);
      safeDOM.append(document.body, container);
    },
    removeLoading() {
      safeDOM.remove(document.head, style);
      safeDOM.remove(document.body, container);
    },
  };
};

// eslint-disable-next-line react-hooks/rules-of-hooks
const { appendLoading, removeLoading } = useLoading();
domReady().then(appendLoading);

window.onmessage = (event) => {
  event.data.payload === 'removeLoading' && removeLoading();
};

setTimeout(removeLoading, 4999);

export {};
