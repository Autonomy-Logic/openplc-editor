/********************************************************************************
  * Copyright (C) 2025 Autonomy
  *
  * This file is generated by xml2st.
  * Do not edit this file directly.
  * If you want to change the content, edit the jinja2 template
  * or the source PLC program and regenerate.
  ********************************************************************************/

#include "iec_std_lib.h"

TIME __CURRENT_TIME;
extern unsigned long long common_ticktime__;

#define BUFFER_SIZE		1024

//Internal buffers for I/O and memory. These buffers are defined in the
//main program

//Booleans
static IEC_BOOL *(*bool_input_ptr)[8] = NULL;
static IEC_BOOL *(*bool_output_ptr)[8] = NULL;

//Bytes
static IEC_BYTE *(*byte_input_ptr) = NULL;
static IEC_BYTE *(*byte_output_ptr) = NULL;

//Analog I/O
static IEC_UINT *(*int_input_ptr) = NULL;
static IEC_UINT *(*int_output_ptr) = NULL;

//32bit I/O
static IEC_UDINT *(*dint_input_ptr) = NULL;
static IEC_UDINT *(*dint_output_ptr) = NULL;

//64bit I/O
static IEC_ULINT *(*lint_input_ptr) = NULL;
static IEC_ULINT *(*lint_output_ptr) = NULL;

//Memory
static IEC_UINT *(*int_memory_ptr) = NULL;
static IEC_UDINT *(*dint_memory_ptr) = NULL;
static IEC_ULINT *(*lint_memory_ptr) = NULL;

#define __LOCATED_VAR(type, name, ...) type __##name;
#include "LOCATED_VARIABLES.h"
#undef __LOCATED_VAR
#define __LOCATED_VAR(type, name, ...) type* name = &__##name;
#include "LOCATED_VARIABLES.h"
#undef __LOCATED_VAR

void setBufferPointers(IEC_BOOL *input_bool[BUFFER_SIZE][8], IEC_BOOL *output_bool[BUFFER_SIZE][8],
						IEC_BYTE *input_byte[BUFFER_SIZE], IEC_BYTE *output_byte[BUFFER_SIZE],
						IEC_UINT *input_int[BUFFER_SIZE], IEC_UINT *output_int[BUFFER_SIZE],
						IEC_UDINT *input_dint[BUFFER_SIZE], IEC_UDINT *output_dint[BUFFER_SIZE],
						IEC_ULINT *input_lint[BUFFER_SIZE], IEC_ULINT *output_lint[BUFFER_SIZE],
						IEC_UINT *int_memory[BUFFER_SIZE], IEC_UDINT *dint_memory[BUFFER_SIZE], 
                        IEC_ULINT *lint_memory[BUFFER_SIZE])
{
	bool_input_ptr = input_bool;
	bool_output_ptr = output_bool;
	byte_input_ptr = input_byte;
	byte_output_ptr = output_byte;
	int_input_ptr = input_int;
	int_output_ptr = output_int;
	dint_input_ptr = input_dint;
	dint_output_ptr = output_dint;
	lint_input_ptr = input_lint;
	lint_output_ptr = output_lint;
	int_memory_ptr = int_memory;
	dint_memory_ptr = dint_memory;
	lint_memory_ptr = lint_memory;
}

void glueVars()
{
	{% for v in vars %}
    {{ v.glue_code }}
    {% endfor %}
}

void updateTime()
{
	__CURRENT_TIME.tv_sec  += common_ticktime__ / 1000000000ULL;
	__CURRENT_TIME.tv_nsec += common_ticktime__ % 1000000000ULL;

	if (__CURRENT_TIME.tv_nsec >= 1000000000ULL)
	{
		__CURRENT_TIME.tv_nsec -= 1000000000ULL;
		__CURRENT_TIME.tv_sec += 1;
	}
}
